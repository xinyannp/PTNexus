import{C as Xt,d as lt,p as z,r as g,c as f,j as C,b as n,e as I,w as l,h as s,x as oe,D as Gt,t as c,G as Qt,H as Zt,I as es,J as ts,K as ss,F as K,k as te,i as r,n as se,g as p,l as M,L as ee,M as as,m as nt,N as tt,s as ls,o as ns,f as J,O as os,u as Fe,v as is,P as rs,z as $,Q as ds,q as us,B as cs}from"./index-BhbkXXvN.js";import{u as ps,C as vs}from"./CrossSeedPanel-QwI5ISjH.js";const ot=Xt("siteData",{state:()=>({dialogVisible:!1,currentTorrent:null,downloadersMap:new Map,allDownloaders:[]}),actions:{openDialog(ie,re){this.currentTorrent=ie,this.dialogVisible=!0,this.allDownloaders=re||[],this.downloadersMap.clear(),re&&re.forEach(de=>{this.downloadersMap.set(de.id,de.name)})},closeDialog(){this.dialogVisible=!1,this.currentTorrent=null,this.downloadersMap.clear(),this.allDownloaders=[]},setCurrentTorrent(ie){this.currentTorrent=ie},getDownloaderName(ie){return this.downloadersMap.get(ie)||"未知下载器"},getAllDownloaders(){return this.allDownloaders}}}),fs={key:0,class:"modal-overlay"},gs={class:"modal-header"},ms={key:0,class:"site-data-content"},_s={class:"torrent-info"},hs={class:"torrent-name"},ys={class:"name-text"},ws={class:"torrent-stats"},xs={class:"stat-item stat-item--fixed"},ks={class:"stat-value"},Ss={class:"stat-item stat-item--fixed"},bs={class:"stat-value"},$s={class:"stat-item stat-item--path"},Cs=["title"],Is={class:"stat-item stat-item--fixed"},Ds={class:"stat-value"},Ns={class:"stat-item stat-item--fixed"},zs={class:"stat-value"},Ts={class:"content-area"},Us={class:"sites-container"},Es={key:0,class:"sites-grid"},Vs=["onClick"],Ms={class:"site-tile"},Rs={class:"site-content"},Bs={class:"site-name-wrapper"},Ps={class:"site-name-with-link"},Os={class:"site-name-text"},Ls={class:"seeders-info"},As={class:"right-panel"},Fs={class:"downloaders-section"},js={class:"downloaders-list"},Ys=["onClick"],Js={class:"flow-section"},Ws={class:"flow-cards"},qs={class:"flow-card"},Ks={class:"card-content"},Hs={key:0,class:"empty-state"},Xs={key:1,class:"site-info"},Gs={class:"site-name"},Qs={class:"flow-card"},Zs={class:"card-content"},ea={class:"downloader-info current"},ta={class:"flow-card"},sa={class:"card-content"},aa={class:"progress-section"},la={class:"progress-bar-container"},na={class:"progress-percentage"},oa={class:"progress-steps-info"},ia={key:0,class:"current-status"},ra={class:"modal-footer"},da=lt({__name:"SiteDataViewer",props:{torrent:{}},emits:["refresh"],setup(ie,{emit:re}){const de=re,O=ot(),he=z(()=>O.dialogVisible),v=z(()=>O.currentTorrent),T=g(null),R=g(null),ye=z(()=>!v.value||!v.value.sites?[]:Object.entries(v.value.sites).map(([u,d])=>({siteName:u,...d})).sort((u,d)=>(d.seeders||0)-(u.seeders||0))),W=()=>{P(),O.closeDialog()},F=u=>{if(u==null||u<=0)return"0 B";const d=["B","KB","MB","GB","TB","PB"],b=Math.floor(Math.log(u)/Math.log(1024));return`${(u/Math.pow(1024,b)).toFixed(2)} ${d[b]}`},w=u=>!!(u&&(u.startsWith("http")||/^\d+$/.test(u))),_=u=>(u.startsWith("http"),u),j=u=>u.downloaderIds&&u.downloaderIds.length>0?u.downloaderIds.length===1?O.getDownloaderName(u.downloaderIds[0]):`${O.getDownloaderName(u.downloaderIds[0])} +${u.downloaderIds.length-1}`:u.downloaderId?O.getDownloaderName(u.downloaderId):"未知",$e=u=>{T.value=u},ae=u=>T.value===u,B=z(()=>{if(!T.value||!v.value||!v.value.sites)return null;const u=v.value.sites[T.value];return{siteName:T.value,seeders:u?.seeders||0,state:u?.state||"未知"}}),H=u=>{R.value=u},ce=z(()=>O.getAllDownloaders()),Te=z(()=>{if(!v.value)return null;const u=v.value.downloaderIds||[],d=v.value.downloaderId;return u.length>0?{id:u[0],name:O.getDownloaderName(u[0])}:d?{id:d,name:O.getDownloaderName(d)}:null}),D=g(0),Ce=z(()=>{switch(D.value){case 0:return 0;case 1:return 33;case 2:return 66;case 3:return 100;default:return 0}}),we=z(()=>{if(D.value!==0&&D.value===3)return"success"}),pe=u=>({"step-info--pending":D.value<u,"step-info--active":D.value===u,"step-info--completed":D.value>u}),Ie=()=>{switch(D.value){case 1:return"正在暂停种子...";case 2:return"正在导出种子文件并添加...";case 3:return"转种完成！";default:return""}},P=()=>{D.value=0},U=async()=>{if(!T.value||!R.value||!v.value)return;const u=v.value.downloaderId||(v.value.downloaderIds&&v.value.downloaderIds.length>0?v.value.downloaderIds[0]:null);if(!u){alert("无法获取当前下载器信息");return}P();try{D.value=1;const b=await(await fetch("/api/torrent/transfer/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:u,target_downloader_id:R.value,site_name:T.value,torrent_name:v.value.name,torrent_size:v.value.size,save_path:v.value.save_path})})).json();if(!b.success){if(b.suggestions&&b.suggestions.length>0){const le=b.suggestions.map((y,fe)=>`${fe+1}. ${y.name}
   站点: ${y.sites}
   大小: ${(y.size/1073741824).toFixed(2)} GB
   路径: ${y.save_path}`).join(`

`);if(confirm(`准备转移失败: ${b.message}

找到 ${b.suggestion_count} 个相似的种子:

${le}

是否要使用第一个相似种子继续转移？`)&&b.suggestions.length>0){const y=b.suggestions[0];v.value&&(v.value.sites={[y.sites]:v.value.sites[T.value]||{}}),await De(y)}else P()}else alert(`准备转移失败: ${b.message}`),P();return}console.log(`找到 ${b.found_count} 个匹配的种子`),D.value=2;const Y=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:u,target_downloader_id:R.value,site_name:T.value,torrent_name:v.value.name,torrent_size:v.value.size,save_path:v.value.save_path})})).json();if(!Y.success){alert(`转移失败: ${Y.message}`),P();return}D.value=3,console.log("转移完成:",Y);const S=Y.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${S}`),de("refresh")}catch(d){console.error("转移过程中发生错误:",d),alert(`转移过程中发生错误: ${d?.message||"未知错误"}`),P()}},De=async u=>{if(!R.value||!v.value)return;const d=v.value.downloaderId||(v.value.downloaderIds&&v.value.downloaderIds.length>0?v.value.downloaderIds[0]:null);if(!d){alert("无法获取当前下载器信息"),P();return}try{console.log("使用相似种子重试转移:",u),D.value=2;const E=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:d,target_downloader_id:R.value,site_name:u.sites,torrent_name:u.name,torrent_size:u.size,save_path:u.save_path})})).json();if(!E.success){alert(`转移失败: ${E.message}`),P();return}D.value=3,console.log("转移完成:",E);const Y=E.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${Y}`),de("refresh")}catch(b){console.error("重试转移过程中发生错误:",b),alert(`重试转移过程中发生错误: ${b?.message||"未知错误"}`),P()}};return(u,d)=>{const b=I("el-button"),E=I("el-icon"),Y=I("el-link"),S=I("el-tag"),le=I("el-progress"),ve=I("el-card");return he.value?(p(),f("div",fs,[n(ve,{class:"site-data-card",shadow:"always"},{header:l(()=>[s("div",gs,[s("span",null,"站点数据查看 - "+c(v.value?.name),1),n(b,{type:"danger",circle:"",onClick:W,plain:""},{default:l(()=>[...d[1]||(d[1]=[r("X",-1)])]),_:1})])]),default:l(()=>[v.value?(p(),f("div",ms,[s("div",_s,[s("div",hs,[n(E,{class:"torrent-icon"},{default:l(()=>[n(oe(Gt))]),_:1}),s("span",ys,c(v.value.name),1)]),s("div",ws,[s("div",xs,[n(E,{class:"stat-icon"},{default:l(()=>[n(oe(Qt))]),_:1}),d[2]||(d[2]=s("span",{class:"stat-label"},"大小",-1)),s("span",ks,c(F(v.value.size)),1)]),s("div",Ss,[n(E,{class:"stat-icon"},{default:l(()=>[n(oe(Zt))]),_:1}),d[3]||(d[3]=s("span",{class:"stat-label"},"上传",-1)),s("span",bs,c(v.value.total_uploaded_formatted||F(v.value.total_uploaded)),1)]),s("div",$s,[n(E,{class:"stat-icon"},{default:l(()=>[n(oe(es))]),_:1}),d[4]||(d[4]=s("span",{class:"stat-label"},"路径",-1)),s("span",{class:"stat-value",title:v.value.save_path},c(v.value.save_path),9,Cs)]),s("div",Is,[n(E,{class:"stat-icon"},{default:l(()=>[n(oe(ts))]),_:1}),d[5]||(d[5]=s("span",{class:"stat-label"},"下载器",-1)),s("span",Ds,c(j(v.value)),1)]),s("div",Ns,[n(E,{class:"stat-icon"},{default:l(()=>[n(oe(ss))]),_:1}),d[6]||(d[6]=s("span",{class:"stat-label"},"可转种",-1)),s("span",zs,c(v.value.target_sites_count||0)+"个",1)])])]),s("div",Ts,[s("div",Us,[ye.value.length>0?(p(),f("div",Es,[(p(!0),f(K,null,te(ye.value,y=>(p(),f("div",{key:y.siteName,class:se(["site-card",{"site-card--selected":ae(y.siteName)}]),onClick:fe=>$e(y.siteName)},[s("div",Ms,[s("div",Rs,[s("div",Bs,[s("div",Ps,[s("span",Os,c(y.siteName),1),w(y.comment)?(p(),M(Y,{key:0,href:_(y.comment),target:"_blank",underline:!1,class:"site-link-icon",onClick:d[0]||(d[0]=ee(()=>{},["stop"]))},{default:l(()=>[n(E,{size:"10"},{default:l(()=>[n(oe(as))]),_:1})]),_:1},8,["href"])):C("",!0)])]),s("div",Ls,[n(S,{type:y.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(c(y.seeders||0)+"人做种 ",1)]),_:2},1032,["type"])])])])],10,Vs))),128))])):C("",!0)]),s("div",As,[s("div",Fs,[d[7]||(d[7]=s("div",{class:"section-title"},"下载器",-1)),s("div",js,[(p(!0),f(K,null,te(ce.value,y=>(p(),f("div",{key:y.id,class:se(["downloader-item",{"downloader-item--selected":R.value===y.id}]),onClick:fe=>H(y.id)},c(y.name),11,Ys))),128))])]),s("div",Js,[s("div",Ws,[s("div",qs,[d[8]||(d[8]=s("div",{class:"card-title"},"选中站点",-1)),s("div",Ks,[B.value?(p(),f("div",Xs,[s("div",Gs,c(B.value.siteName),1),n(S,{type:B.value.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(c(B.value.seeders)+"人做种 ",1)]),_:1},8,["type"])])):(p(),f("div",Hs,"未选择"))])]),d[11]||(d[11]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",Qs,[d[9]||(d[9]=s("div",{class:"card-title"},"当前下载器",-1)),s("div",Zs,[s("div",ea,c(Te.value?.name||"未知"),1)])]),d[12]||(d[12]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",ta,[d[10]||(d[10]=s("div",{class:"card-title"},"目标下载器",-1)),s("div",sa,[s("div",{class:se(["downloader-info target",{selected:R.value}])},c(R.value?oe(O).getDownloaderName(R.value):"未选择"),3)])])])]),s("div",aa,[d[16]||(d[16]=s("div",{class:"progress-title"},"转种流程",-1)),s("div",la,[n(le,{percentage:Ce.value,status:we.value,"stroke-width":8,"show-text":!0},{default:l(({percentage:y})=>[s("span",na,c(y)+"%",1)]),_:1},8,["percentage","status"]),s("div",oa,[s("div",{class:se(["step-info",pe(1)])},[...d[13]||(d[13]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"暂停种子"),s("div",{class:"step-desc"},"暂停下载器中选择的站点种子")],-1)])],2),s("div",{class:se(["step-info",pe(2)])},[...d[14]||(d[14]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"导出种子"),s("div",{class:"step-desc"},"导出种子文件并添加到目标下载器")],-1)])],2),s("div",{class:se(["step-info",pe(3)])},[...d[15]||(d[15]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"转移完成"),s("div",{class:"step-desc"},"种子已成功转移到目标下载器")],-1)])],2)]),D.value>0&&D.value<=3?(p(),f("div",ia,c(Ie()),1)):C("",!0)])])])])])):C("",!0),s("div",ra,[n(b,{type:"success",onClick:U,disabled:!T.value||!R.value||D.value>0},{default:l(()=>[...d[17]||(d[17]=[r(" 执行转种 ",-1)])]),_:1},8,["disabled"]),n(b,{type:"primary",onClick:W},{default:l(()=>[...d[18]||(d[18]=[r("关闭",-1)])]),_:1})])]),_:1})])):C("",!0)}}}),ua=nt(da,[["__scopeId","data-v-6ee24ce4"]]),ca={class:"torrents-view"},pa={class:"expand-content"},va=["onClick"],fa=["href"],ga=["onClick"],ma={class:"name-header-container"},_a={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},ha={style:{"white-space":"normal"}},ya={style:{display:"inline-block",width:"100%","text-align":"center"}},wa=["title"],xa={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},ka={key:0},Sa={style:{padding:"1px 0",width:"100%"}},ba={style:{"text-align":"center","font-size":"12px","margin-top":"5px","line-height":"1"}},$a={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ca={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ia={key:0},Da={key:1},Na={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},za={key:3,class:"modal-overlay"},Ta={class:"modal-header"},Ua={key:0,class:"cross-seed-content"},Ea={class:"filter-card-header"},Va={class:"filter-card-body"},Ma={class:"site-filter-container"},Ra={style:{display:"flex","align-items":"center",gap:"15px","margin-bottom":"5px"}},Ba={style:{display:"flex","align-items":"center",gap:"10px"}},Pa={key:0,style:{display:"flex","align-items":"center"}},Oa={key:1,style:{display:"flex","align-items":"center"}},La={class:"site-checkbox-container"},Aa={style:{"margin-bottom":"10px"}},Fa={key:0,style:{display:"flex","align-items":"center"}},ja={style:{"margin-bottom":"10px"}},Ya={key:0,style:{display:"flex","align-items":"center"}},Ja={class:"path-tree-container"},Wa={style:{"margin-bottom":"10px"}},qa={key:0,style:{display:"flex","align-items":"center"}},Ka={class:"filter-card-footer"},Ha={class:"filter-card-header"},Xa={class:"site-operation-body"},Ga={class:"torrent-name-container"},Qa={class:"torrent-name"},Za={key:0,class:"site-operation-link"},el={key:1,class:"site-operation-input"},tl={class:"site-operation-buttons"},sl={key:6,class:"filter-overlay"},al={class:"filter-card-header"},ll={class:"source-site-selection-body"},nl={class:"source-site-tip"},ol={key:0,class:"cached-sites-section"},il={class:"cached-sites-label"},rl={class:"site-list-box glass-site-box cached-sites-box"},dl={key:1,class:"uncached-sites-section"},ul={class:"site-list-box glass-site-box"},cl={class:"filter-card-footer"},pl={class:"filter-card-header"},vl={class:"filter-card-body"},fl={style:{color:"#606266","margin-bottom":"10px"}},gl={class:"filter-card-footer"},ml=220,_l=90,st=30,be=200,hl=2e3,at="torrents_view_first_load",yl=lt({__name:"TorrentsView",emits:["ready"],setup(ie,{emit:re}){const de=re,O=g(null),he=g(!0),v=g([]),T=g(null),R=g(!1),ye=g(!1),W=g(""),F=g({prop:"name",order:"ascending"}),w=tt({paths:[],states:[],existSiteNames:[],notExistSiteNames:[],downloaderIds:[]}),_=tt({...w}),j=g("exist"),$e=z({get:()=>j.value==="exist"?_.existSiteNames:_.notExistSiteNames,set:t=>{j.value==="exist"?_.existSiteNames=t:_.notExistSiteNames=t}}),ae=g(!1),B=g(1),H=g(50),ce=g(0),Te=g([]),D=g([]),Ce=g([]),we=g({}),pe=g([]),Ie=g([]),P=g([]),U=g(null),De=g([]),u=g(!1),d=g([]),b=g(!1),E=g(!1),Y=g(null),S=g(null),le=g(null),ve=g(!1),y=g([]),fe=g(!1),q=ps(),it=ot(),rt=z(()=>!!q.taskId),L=z(()=>q.workingParams);z(()=>q.sourceInfo?.name||"");const ue=g(!1),ge=g(""),N=g(null),Q=g(""),Ne=g({}),Ue=z(()=>{const t=new Intl.Collator("zh-CN",{numeric:!0});return[...Ce.value].sort(t.compare)}),me=g(""),je=z(()=>{if(!me.value)return Ue.value;const t=me.value.toLowerCase();return Ue.value.filter(e=>e.toLowerCase().includes(t))}),dt=t=>{let e=0;for(const o of t)e+=o.charCodeAt(0)>255?14:8;return e},ut=z(()=>{const t=v.value||[];let e=0;for(const i of t){const h=String(i?.save_path||""),x=Ge(h,st)||"";e=Math.max(e,dt(x))}const o=e+40;return Math.min(ml,Math.max(_l,Math.round(o)))}),ct=z(()=>{const t=w,e=[];return t.paths&&t.paths.length>0&&e.push(`路径: ${t.paths.length}`),t.states&&t.states.length>0&&e.push(`状态: ${t.states.length}`),t.existSiteNames&&t.existSiteNames.length>0&&e.push(`存在于: ${t.existSiteNames.length}`),t.notExistSiteNames&&t.notExistSiteNames.length>0&&e.push(`不存在于: ${t.notExistSiteNames.length}`),t.downloaderIds&&t.downloaderIds.length>0&&e.push(`下载器: ${t.downloaderIds.length}`),e.join(", ")}),pt=z(()=>{const t=w;return t.paths&&t.paths.length>0||t.states&&t.states.length>0||t.existSiteNames&&t.existSiteNames.length>0||t.notExistSiteNames&&t.notExistSiteNames.length>0||t.downloaderIds&&t.downloaderIds.length>0});z(()=>{const t=je.value;return j.value==="exist"?t.filter(e=>!_.notExistSiteNames.includes(e)):t.filter(e=>!_.existSiteNames.includes(e))});const Ye=t=>j.value==="exist"?!_.notExistSiteNames.includes(t):!_.existSiteNames.includes(t),vt=[{color:"#f56c6c",percentage:80},{color:"#e6a23c",percentage:99},{color:"#67c23a",percentage:100}],xe=async()=>{try{const t={page_size:H.value,sort_prop:F.value.prop,sort_order:F.value.order,name_search:W.value,active_filters:w};await J.post("/api/ui_settings",t)}catch(t){console.error("无法保存UI设置:",t.message)}},ft=async()=>{try{const e=(await J.get("/api/ui_settings")).data;if(H.value=e.page_size??50,F.value={prop:e.sort_prop||"name",order:"sort_order"in e?e.sort_order:"ascending"},W.value=e.name_search??"",e.active_filters){Object.assign(w,e.active_filters),w.existSiteNames||(w.existSiteNames=[]),w.notExistSiteNames||(w.notExistSiteNames=[]);const o=w;o.siteExistence&&delete o.siteExistence,o.siteNames&&delete o.siteNames}}catch(t){console.error("加载UI设置时出错:",t)}finally{R.value=!0}},gt=t=>{const e=[],o=new Map;return t.sort().forEach(i=>{const h=i.replace(/^\/|\/$/g,"").split("/");let x="",m=e;h.forEach((ne,X)=>{if(x=X===0?`/${ne}`:`${x}/${ne}`,!o.has(x)){const A={path:X===h.length-1?i:x,label:ne,children:[]};o.set(x,A),m.push(A)}m=o.get(x).children})}),o.forEach(i=>{i.children&&i.children.length===0&&delete i.children}),e},mt=async()=>{try{const e=(await J.get("/api/all_downloaders")).data;Ie.value=e.filter(o=>o.enabled),P.value=e}catch(t){T.value=t.message}},_t=async()=>{try{const e=(await J.get("/api/sites/status")).data;d.value=e.filter(o=>o.is_source)}catch(t){T.value=t.message}},V=async()=>{he.value=!0,T.value=null;try{const t=new URLSearchParams({page:B.value.toString(),pageSize:H.value.toString(),nameSearch:W.value,sortProp:F.value.prop||"name",sortOrder:F.value.order||"ascending",existSiteNames:JSON.stringify(w.existSiteNames),notExistSiteNames:JSON.stringify(w.notExistSiteNames),path_filters:JSON.stringify(w.paths||[]),state_filters:JSON.stringify(w.states),downloader_filters:JSON.stringify(w.downloaderIds)}),o=(await J.get(`/api/data?${t.toString()}`)).data;if(o.error)throw new Error(o.error);v.value=o.data,ce.value=o.total,H.value!==o.pageSize&&(H.value=o.pageSize),Te.value=o.unique_paths,D.value=o.unique_states,Ce.value=o.all_discovered_sites,we.value=o.site_link_rules,w.paths=o.active_path_filters,De.value=gt(o.unique_paths)}catch(t){T.value=t.message}finally{he.value=!1}},ht=async t=>{q.reset();const e=Object.entries(t.sites).map(([o,i])=>({siteName:o,...i})).filter(o=>{if(!(o.migration===1||o.migration===3))return!1;const h=o.comment&&o.comment.includes("details.php?id="),x=o.comment&&/^\d+$/.test(o.comment.trim());return h||x});q.setParams(t),await xt(t),e.length===0&&$.warning("该种子暂无可用的源站点，您可以使用 IYUU 查询来发现更多站点。"),u.value=!0},yt=t=>{it.openDialog(t,P.value)},wt=()=>{console.log("触发种子数据刷新"),V()},xt=async t=>{fe.value=!0,y.value=[];try{const o=(await J.get(`/api/cached_sites?name=${encodeURIComponent(t.name)}&size=${t.size}`)).data;o.success?(y.value=o.cached_sites||[],console.log("缓存站点查询结果:",y.value)):console.warn("查询缓存站点失败:",o.error)}catch(e){console.error("查询缓存站点时出错:",e)}finally{fe.value=!1}},Je=async t=>{const e=L.value;if(!e||!t){$.error("发生内部错误：未找到选中的种子或站点信息。");return}const o=e.sites[t.siteName],i=t.siteName;if(!o){$.error(`未找到站点 [${i}] 的数据。`);return}if(!ke(o,i)){$.info(`站点 [${i}] 缺少详情链接，正在触发 IYUU 查询...`),Ne.value[i]=!0,await Xe(),Ne.value[i]=!1;return}let h=null;const x=o?.comment?.match(/id=(\d+)/);if(x&&x[1])h=x[1];else if(o?.comment&&/^\d+$/.test(o.comment.trim()))h=o.comment.trim();else{$.error(`无法从源站点 ${i} 的详情页链接中提取种子ID。请尝试使用IYUU查询更新链接。`);return}o&&(o.torrentId=h);const m=d.value.find(X=>X.name===i)?.site||i.toLowerCase();$.success(`准备从站点 [${i}] 开始迁移种子...`);const ne={name:i,site:m,torrentId:h};q.setSourceInfo(ne),q.setTaskId(e.name+"_"+Date.now()),u.value=!1},_e=t=>{if(!!!(L.value&&L.value.sites[t]))return!1;const o=d.value.find(i=>i.name===t);return!o||!o.has_cookie&&t!=="肉丝"?!1:t==="杜比"||t==="HDtime"||t==="肉丝"?!!o.has_passkey:!0},We=()=>{q.reset()},qe=(t,e)=>{ge.value=t,N.value=e,Q.value="",ue.value=!0},Ke=async()=>{if(!ge.value||!N.value){$.error("缺少必要的参数");return}if(!Q.value||Q.value.trim()===""){$.error("请输入详情页链接或ID");return}try{const e=(await J.post("/api/sites/update_comment",{torrent_name:ge.value,site_name:N.value.name,comment:Q.value.trim()})).data;e.success?($.success("详情页链接已成功添加"),ue.value=!1,Q.value="",await V()):$.error(e.error||"添加详情页链接失败")}catch(t){console.error("添加详情页链接时出错:",t),$.error("添加详情页链接时发生网络错误")}},kt=async()=>{if(!ge.value||!N.value){$.error("缺少必要的参数");return}try{const t=await J.post("/api/sites/set_not_exist",{torrent_name:ge.value,site_name:N.value.name});$.success("站点状态已成功设置为不存在"),ue.value=!1,V()}catch(t){console.error("设置站点状态时出错:",t),$.error(t.response?.data?.error||"设置站点状态时发生错误")}},St=()=>{$.success("转种操作已完成！"),q.reset(),V()},bt=()=>{$.success("转种操作已完成！"),q.reset(),V()},He=t=>{if(!L.value)return null;const e=L.value.sites[t];return e?{siteName:t,...e}:null},ze=()=>{le.value&&(clearInterval(le.value),le.value=null)},Ee=async()=>{if(Y.value)try{const t=await J.get(`/api/iyuu_query_batch_progress?task_id=${encodeURIComponent(Y.value)}`);if(t.data?.success){if(S.value=t.data.task,S.value&&!S.value.isRunning&&(ze(),!ve.value))if(ve.value=!0,S.value.success){$.success(S.value.message||"IYUU批量查询已完成"),await V();const e=L.value;if(e){const o=v.value.find(i=>i.name===e.name&&i.size===e.size);o&&q.setParams(o)}}else $.error(S.value.message||"IYUU批量查询失败")}else $.error(t.data?.message||"获取IYUU批量查询进度失败")}catch(t){$.error(t.response?.data?.message||"获取IYUU批量查询进度时发生网络错误")}},$t=()=>{ze(),Ee(),le.value=setInterval(async()=>{await Ee()},hl)},Ve=()=>{E.value=!1,ze()},Xe=async()=>{const t=L.value,e=ce.value||0;if(e<=0){$.warning("当前筛选条件下无可查询的种子");return}const o=Math.min(e,be);try{await ds.confirm(`将对当前筛选结果的前 ${o} 个种子组执行 IYUU 查询（当前筛选共 ${e} 个）。继续？`,"IYUU 批量查询",{confirmButtonText:"开始查询",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1})}catch{return}b.value=!0;try{const i=new URLSearchParams({page:"1",pageSize:o.toString(),nameSearch:W.value,sortProp:F.value.prop||"name",sortOrder:F.value.order||"ascending",existSiteNames:JSON.stringify(w.existSiteNames),notExistSiteNames:JSON.stringify(w.notExistSiteNames),path_filters:JSON.stringify(w.paths||[]),state_filters:JSON.stringify(w.states),downloader_filters:JSON.stringify(w.downloaderIds)}),x=(await J.get(`/api/data?${i.toString()}`)).data;if(x.error)throw new Error(x.error);const m=(x.data||[]).slice(0,be).map(G=>({name:G.name,size:G.size,save_path:G.save_path})).filter(G=>G.name&&G.size);if(t&&t.name&&t.size&&!m.some(A=>A.name===t.name&&A.size===t.size)){const A={name:t.name,size:t.size,save_path:t.save_path};m.length>=be&&m.pop(),m.unshift(A)}if(m.length===0){$.warning("当前筛选结果中未找到可查询的种子组");return}(x.total||0)>be&&$.info(`筛选结果共 ${x.total} 个，本次仅查询前 ${m.length} 个`);const X=(await J.post("/api/iyuu_query_batch",{torrents:m,max_groups:be,force_query:!0})).data;if(!X?.success){$.error(X?.message||"启动批量IYUU查询失败");return}Y.value=X.task_id,S.value=null,ve.value=!1,E.value=!0,$t()}catch(i){console.error("触发筛选结果 IYUU 批量查询时出错:",i),$.error(i.response?.data?.message||i.message||"触发IYUU批量查询失败")}finally{b.value=!1}};ls(()=>{ze()});const Ct=t=>{H.value=t,B.value=1,V(),xe()},It=t=>{B.value=t,V()},Dt=t=>{F.value=t,B.value=1,V(),xe()},Nt=()=>{Object.assign(_,w),ae.value=!0,us(()=>{U.value&&U.value.setCheckedKeys(w.paths,!1)})},zt=async()=>{if(U.value){const t=U.value.getCheckedKeys(!1);_.paths=t}Object.assign(w,_),ae.value=!1,B.value=1,await V(),xe()},Tt=()=>{_.paths=[],_.states=[],_.existSiteNames=[],_.notExistSiteNames=[],_.downloaderIds=[],j.value="exist",me.value="",U.value&&U.value.setCheckedKeys([],!1)},Ut=()=>{if(_.existSiteNames=[],j.value==="exist"&&U.value){const t=U.value.getCheckedKeys(!0);_.paths=t}},Et=()=>{if(_.notExistSiteNames=[],j.value==="not-exist"&&U.value){const t=U.value.getCheckedKeys(!0);_.paths=t}},Vt=()=>{_.paths=[],U.value&&U.value.setCheckedKeys([],!1)},Mt=()=>{_.states=[]},Rt=()=>{_.downloaderIds=[]},Bt=async()=>{w.paths=[],w.states=[],w.existSiteNames=[],w.notExistSiteNames=[],w.downloaderIds=[],W.value="",j.value="exist",me.value="",U.value&&U.value.setCheckedKeys([],!1),B.value=1,await V(),xe()},Me=t=>{if(t==null||t<=0)return"0 B";const e=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(t)/Math.log(1024));return`${(t/Math.pow(1024,o)).toFixed(2)} ${e[o]}`},ke=(t,e)=>{const{comment:o}=t;return!!(o&&(o.startsWith("http")||/^\d+$/.test(o)&&we.value[e]))},Re=(t,e)=>{const{comment:o}=t;if(o.startsWith("http"))return o;const i=we.value[e];return i&&/^\d+$/.test(o)?`${(i.base_url.startsWith("http")?i.base_url:`https://${i.base_url}`).replace(/\/$/,"")}/details.php?id=${o}`:null},Be=t=>t.state==="未做种"?"danger":t.state==="不存在"?"info":t.comment?"success":t.state==="做种中"?"primary":"info",Pe=t=>{if(!t)return"未知下载器";const e=P.value.find(o=>o.id===t);return e?e.name:"未知下载器"},Pt=t=>{if(!t||!P.value.find(h=>h.id===t))return"info";let o=0;for(let h=0;h<t.length;h++)o=t.charCodeAt(h)+((o<<5)-o);const i=["primary","success","warning","danger","info"];return i[Math.abs(o)%i.length]},Ot=t=>[...t].sort((o,i)=>{const h=Pe(o),x=Pe(i);return h.localeCompare(x,"zh-CN")}),Ge=(t,e=50)=>{if(!t||t.length<=e)return t;const o=Math.floor((e-3)/2);let i=t.substring(0,o),h=t.substring(t.length-o);const x=i.lastIndexOf("/"),m=h.indexOf("/");return x>0&&m>=0&&(i=i.substring(0,x),h=h.substring(m+1)),`${i}...${h}`},Qe=(t,e)=>{if(!!!(L.value&&L.value.sites[t.name]))return"info";const i=L.value.sites[t.name];return!t.has_cookie||(t.name==="杜比"||t.name==="肉丝")&&!t.has_passkey?"error":t.has_cookie&&i.comment?"success":"primary"},Lt=t=>t.state==="做种中"&&t.progress<100?"部分做种":t.state,At=(t,e)=>e&&e.state==="做种中"&&e.progress<100?"warning":t.includes("下载")?"primary":t.includes("做种")?"success":t.includes("暂停")?"warning":t.includes("错误")||t.includes("丢失")?"danger":"info",Ft=t=>O.value?.toggleRowExpansion(t),jt=(t,e)=>{pe.value=e.map(o=>o.unique_id)},Yt=({row:t})=>pe.value.includes(t.unique_id)?"expanded-row":"";ns(async()=>{const t=!sessionStorage.getItem(at);if(await ft(),V(),t){try{console.log("首次加载页面，触发种子数据刷新..."),await J.post("/api/refresh_data"),console.log("种子数据刷新完成，重新获取数据..."),await V()}catch(e){console.warn("页面加载时种子数据刷新失败:",e)}sessionStorage.setItem(at,"loaded")}else console.log("页面已加载过，跳过种子数据刷新");mt(),_t(),de("ready",V),Jt()});const Jt=()=>{ye.value=!1};return os(W,()=>{B.value=1,V(),xe()}),(t,e)=>{const o=I("el-alert"),i=I("el-tag"),h=I("el-table-column"),x=I("el-input"),m=I("el-button"),ne=I("el-progress"),X=I("el-table"),G=I("el-pagination"),A=I("el-card"),Se=I("el-divider"),Ze=I("el-radio-button"),Wt=I("el-radio-group"),Oe=I("el-checkbox"),Le=I("el-checkbox-group"),qt=I("el-tree"),Kt=I("el-link"),Z=I("el-descriptions-item"),et=I("el-descriptions"),Ae=is("loading");return p(),f("div",ca,[T.value?(p(),M(o,{key:0,title:T.value,type:"error","show-icon":"",closable:!1,center:"",style:{"margin-bottom":"15px"}},null,8,["title"])):C("",!0),R.value?Fe((p(),M(X,{key:1,data:v.value,border:"",height:"100%",ref_key:"tableRef",ref:O,"row-key":"unique_id","row-class-name":Yt,onRowClick:Ft,onExpandChange:jt,onSortChange:Dt,"default-sort":F.value,"empty-text":"无数据或当前筛选条件下无结果",class:"glass-table"},{default:l(()=>[n(h,{type:"expand",width:"1"},{default:l(a=>[s("div",pa,[(p(!0),f(K,null,te(Ue.value,k=>(p(),f(K,{key:k},[a.row.sites[k]?(p(),f(K,{key:0},[a.row.sites[k].state==="未做种"?(p(),f("div",{key:0,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:ee(Ht=>qe(a.row.name,{name:k,data:a.row.sites[k]}),["stop"])},[n(i,{effect:"dark",type:Be(a.row.sites[k]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(c(k)+" ",1),s("div",null,"("+c(Me(a.row.sites[k].uploaded))+")",1)]),_:2},1032,["type"])],8,va)):a.row.sites[k]&&ke(a.row.sites[k],k)?(p(),f("a",{key:1,href:Re(a.row.sites[k],k),target:"_blank",style:{"text-decoration":"none"}},[n(i,{effect:"dark",type:Be(a.row.sites[k]),style:{"text-align":"center"}},{default:l(()=>[r(c(k)+" ",1),s("div",null,"("+c(Me(a.row.sites[k].uploaded))+")",1)]),_:2},1032,["type"])],8,fa)):(p(),f("div",{key:2,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:ee(Ht=>qe(a.row.name,{name:k,data:a.row.sites[k]}),["stop"])},[n(i,{effect:"dark",type:Be(a.row.sites[k]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(c(k)+" ",1),s("div",null,"("+c(Me(a.row.sites[k].uploaded))+")",1)]),_:2},1032,["type"])],8,ga))],64)):(p(),M(i,{key:1,type:"info",effect:"plain"},{default:l(()=>[r(c(k),1)]),_:2},1024))],64))),128))])]),_:1}),n(h,{prop:"name","min-width":"450",sortable:"custom"},{header:l(()=>[s("div",ma,[e[22]||(e[22]=s("div",null,"种子",-1)),n(x,{modelValue:W.value,"onUpdate:modelValue":e[0]||(e[0]=a=>W.value=a),placeholder:"搜索名称...",clearable:"",class:"search-input",onClick:e[1]||(e[1]=ee(()=>{},["stop"]))},null,8,["modelValue"]),s("span",{onClick:e[2]||(e[2]=ee(()=>{},["stop"])),style:{display:"flex","align-items":"center"}},[pt.value?(p(),f("div",_a,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r(c(ct.value),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:Bt},{default:l(()=>[...e[20]||(e[20]=[r("清除",-1)])]),_:1})])):C("",!0),n(m,{type:"primary",onClick:Nt,plain:""},{default:l(()=>[...e[21]||(e[21]=[r("筛选",-1)])]),_:1})])])]),default:l(a=>[s("span",ha,c(a.row.name),1)]),_:1}),n(h,{prop:"site_count",label:"做种数",sortable:"custom",width:"95",align:"center","header-align":"center"},{default:l(a=>[s("span",ya,c(a.row.site_count)+" / "+c(a.row.total_site_count),1)]),_:1}),n(h,{prop:"save_path",label:"保存路径",width:ut.value,"header-align":"center"},{default:l(a=>[s("div",{title:a.row.save_path,style:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},c(Ge(a.row.save_path,st)),9,wa)]),_:1},8,["width"]),n(h,{label:"下载器",width:"130",align:"center","header-align":"center"},{default:l(a=>[s("div",xa,[a.row.downloaderIds&&a.row.downloaderIds.length>0?(p(),f("div",ka,[(p(!0),f(K,null,te(Ot(a.row.downloaderIds),k=>(p(),M(i,{key:k,size:"small",type:Pt(k),style:{margin:"2px"}},{default:l(()=>[r(c(Pe(k)),1)]),_:2},1032,["type"]))),128))])):(p(),M(i,{key:1,type:"info",size:"small"},{default:l(()=>[...e[23]||(e[23]=[r(" 未知下载器 ",-1)])]),_:1}))])]),_:1}),n(h,{label:"大小",prop:"size_formatted",width:"100",align:"center",sortable:"custom"}),n(h,{label:"总上传量",prop:"total_uploaded_formatted",width:"110",align:"center",sortable:"custom"}),n(h,{label:"进度",prop:"progress",width:"90",align:"center",sortable:"custom"},{default:l(a=>[s("div",Sa,[n(ne,{percentage:a.row.progress,"stroke-width":10,color:vt,"show-text":!1,style:{width:"100%"}},null,8,["percentage"]),s("div",ba,c(a.row.progress)+"% ",1)])]),_:1}),n(h,{label:"状态",prop:"state",width:"120",align:"center","header-align":"center"},{default:l(a=>[s("div",$a,[n(i,{type:At(a.row.state,a.row),size:"large"},{default:l(()=>[r(c(Lt(a.row)),1)]),_:2},1032,["type"])])]),_:1}),n(h,{label:"可转种",width:"100",align:"center","header-align":"center",prop:"target_sites_count",sortable:"custom"},{default:l(a=>[s("div",Ca,[a.row.target_sites_count!==void 0?(p(),f("span",Ia,c(a.row.target_sites_count),1)):(p(),f("span",Da,"-"))])]),_:1}),n(h,{label:"操作",width:"100",align:"center","header-align":"center"},{default:l(a=>[s("div",Na,[n(m,{type:"primary",size:"small",onClick:ee(k=>ht(a.row),["stop"]),disabled:!ye.value&&a.row.progress<100},{default:l(()=>[...e[24]||(e[24]=[r(" 转种 ",-1)])]),_:1},8,["onClick","disabled"])])]),_:1})]),_:1},8,["data","default-sort"])),[[Ae,he.value]]):C("",!0),ce.value>0?(p(),M(G,{key:2,class:"glass-pagination",style:{"justify-content":"flex-end"},"current-page":B.value,"onUpdate:currentPage":e[3]||(e[3]=a=>B.value=a),"page-size":H.value,"onUpdate:pageSize":e[4]||(e[4]=a=>H.value=a),"page-sizes":[20,50,100],total:ce.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ct,onCurrentChange:It,background:""},null,8,["current-page","page-size","total"])):C("",!0),rt.value?(p(),f("div",za,[n(A,{class:"cross-seed-card",shadow:"always"},{header:l(()=>[s("div",Ta,[s("span",null,"转种 - "+c(L.value?.name),1),n(m,{type:"danger",circle:"",onClick:We,plain:""},{default:l(()=>[...e[25]||(e[25]=[r("X",-1)])]),_:1})])]),default:l(()=>[L.value?(p(),f("div",Ua,[n(vs,{onComplete:St,onCancel:We,onCloseWithRefresh:bt})])):C("",!0)]),_:1})])):C("",!0),ae.value?(p(),f("div",{key:4,class:"filter-overlay",onClick:e[12]||(e[12]=ee(a=>ae.value=!1,["self"]))},[n(A,{class:"filter-card"},{header:l(()=>[s("div",Ea,[e[27]||(e[27]=s("span",null,"筛选选项",-1)),n(m,{type:"danger",circle:"",onClick:e[5]||(e[5]=a=>ae.value=!1),plain:""},{default:l(()=>[...e[26]||(e[26]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",Va,[n(Se,{"content-position":"left"},{default:l(()=>[...e[28]||(e[28]=[r("站点筛选",-1)])]),_:1}),s("div",Ma,[s("div",Ra,[n(Wt,{modelValue:j.value,"onUpdate:modelValue":e[6]||(e[6]=a=>j.value=a),size:"default"},{default:l(()=>[n(Ze,{label:"exist",class:"compact-radio-button"},{default:l(()=>[...e[29]||(e[29]=[r("存在于",-1)])]),_:1}),n(Ze,{label:"not-exist",class:"compact-radio-button"},{default:l(()=>[...e[30]||(e[30]=[r("不存在于",-1)])]),_:1})]),_:1},8,["modelValue"]),n(x,{modelValue:me.value,"onUpdate:modelValue":e[7]||(e[7]=a=>me.value=a),placeholder:"搜索站点",clearable:"",style:{width:"280px","font-size":"14px"},size:"default"},null,8,["modelValue"]),s("div",Ba,[_.existSiteNames.length>0?(p(),f("div",Pa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("存在于: "+c(_.existSiteNames.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Ut},{default:l(()=>[...e[31]||(e[31]=[r("清除",-1)])]),_:1})])):C("",!0),_.notExistSiteNames.length>0?(p(),f("div",Oa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("不存在于: "+c(_.notExistSiteNames.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Et},{default:l(()=>[...e[32]||(e[32]=[r("清除",-1)])]),_:1})])):C("",!0)])]),s("div",La,[n(Le,{modelValue:$e.value,"onUpdate:modelValue":e[8]||(e[8]=a=>$e.value=a)},{default:l(()=>[(p(!0),f(K,null,te(je.value,a=>(p(),M(Oe,{key:a,label:a,disabled:!Ye(a),class:se({"disabled-site":!Ye(a)})},{default:l(()=>[r(c(a),1)]),_:2},1032,["label","disabled","class"]))),128))]),_:1},8,["modelValue"])])]),n(Se,{"content-position":"left"},{default:l(()=>[...e[33]||(e[33]=[r("下载器",-1)])]),_:1}),s("div",Aa,[_.downloaderIds.length>0?(p(),f("div",Fa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("下载器: "+c(_.downloaderIds.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Rt},{default:l(()=>[...e[34]||(e[34]=[r("清除",-1)])]),_:1})])):C("",!0)]),n(Le,{modelValue:_.downloaderIds,"onUpdate:modelValue":e[9]||(e[9]=a=>_.downloaderIds=a)},{default:l(()=>[(p(!0),f(K,null,te(Ie.value,a=>(p(),M(Oe,{key:a.id,label:a.id},{default:l(()=>[r(c(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),n(Se,{"content-position":"left"},{default:l(()=>[...e[35]||(e[35]=[r("保存路径",-1)])]),_:1}),s("div",ja,[_.paths.length>0?(p(),f("div",Ya,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("路径: "+c(_.paths.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Vt},{default:l(()=>[...e[36]||(e[36]=[r("清除",-1)])]),_:1})])):C("",!0)]),s("div",Ja,[n(qt,{ref_key:"pathTreeRef",ref:U,data:De.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),n(Se,{"content-position":"left"},{default:l(()=>[...e[37]||(e[37]=[r("状态",-1)])]),_:1}),s("div",Wa,[_.states.length>0?(p(),f("div",qa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("状态: "+c(_.states.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Mt},{default:l(()=>[...e[38]||(e[38]=[r("清除",-1)])]),_:1})])):C("",!0)]),n(Le,{modelValue:_.states,"onUpdate:modelValue":e[10]||(e[10]=a=>_.states=a)},{default:l(()=>[(p(!0),f(K,null,te(D.value,a=>(p(),M(Oe,{key:a,label:a},{default:l(()=>[r(c(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),s("div",Ka,[n(m,{onClick:Tt},{default:l(()=>[...e[39]||(e[39]=[r("清除筛选",-1)])]),_:1}),n(m,{onClick:e[11]||(e[11]=a=>ae.value=!1)},{default:l(()=>[...e[40]||(e[40]=[r("取消",-1)])]),_:1}),n(m,{type:"primary",onClick:zt},{default:l(()=>[...e[41]||(e[41]=[r("确认",-1)])]),_:1})])]),_:1})])):C("",!0),ue.value?(p(),f("div",{key:5,class:"filter-overlay",onClick:e[16]||(e[16]=ee(a=>ue.value=!1,["self"]))},[n(A,{class:"filter-card",style:{"max-width":"500px"}},{header:l(()=>[s("div",Ha,[e[43]||(e[43]=s("span",null,"站点操作",-1)),n(m,{type:"danger",circle:"",onClick:e[13]||(e[13]=a=>ue.value=!1),plain:""},{default:l(()=>[...e[42]||(e[42]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",Xa,[s("div",Ga,[e[44]||(e[44]=s("p",{class:"label"},"种子名称:",-1)),s("p",Qa,c(ge.value),1)]),s("p",null,"站点名称: "+c(N.value?.name),1),s("p",null,"当前状态: "+c(N.value?.data.state),1),N.value&&N.value.data&&ke(N.value.data,N.value.name)?(p(),f("div",Za,[e[45]||(e[45]=s("p",{class:"label"},"详情页链接:",-1)),n(Kt,{href:Re(N.value.data,N.value.name),target:"_blank",type:"primary",underline:!1},{default:l(()=>[r(c(Re(N.value.data,N.value.name)),1)]),_:1},8,["href"])])):(p(),f("div",el,[e[46]||(e[46]=s("p",{class:"label"},"添加详情页链接或种子ID:",-1)),n(x,{modelValue:Q.value,"onUpdate:modelValue":e[14]||(e[14]=a=>Q.value=a),placeholder:"请输入完整的详情页链接或种子ID",clearable:"",onKeyup:rs(Ke,["enter"])},null,8,["modelValue"]),e[47]||(e[47]=s("p",{class:"input-hint"}," 支持输入完整链接（如：https://example.com/details.php?id=123）或仅输入数字ID（如：9999999996） ",-1))])),s("div",tl,[n(m,{onClick:e[15]||(e[15]=a=>ue.value=!1)},{default:l(()=>[...e[48]||(e[48]=[r("取消",-1)])]),_:1}),ke(N.value?.data,N.value?.name)?C("",!0):(p(),M(m,{key:0,type:"success",onClick:Ke,disabled:!Q.value||Q.value.trim()===""},{default:l(()=>[...e[49]||(e[49]=[r(" 添加链接 ",-1)])]),_:1},8,["disabled"])),ke(N.value?.data,N.value?.name)?(p(),M(m,{key:1,type:"primary",onClick:kt},{default:l(()=>[...e[50]||(e[50]=[r(" 设为不存在 ",-1)])]),_:1})):C("",!0)])])]),_:1})])):C("",!0),u.value?(p(),f("div",sl,[n(A,{class:"filter-card",style:{"max-width":"600px"}},{header:l(()=>[s("div",al,[e[52]||(e[52]=s("span",null,"请选择转种的源站点",-1)),n(m,{type:"danger",circle:"",onClick:e[17]||(e[17]=a=>u.value=!1),plain:""},{default:l(()=>[...e[51]||(e[51]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",ll,[s("p",nl,[n(i,{type:"success",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[53]||(e[53]=[r("可获取数据",-1)])]),_:1}),n(i,{type:"primary",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[54]||(e[54]=[r("点击尝试使用iyuu获取链接",-1)])]),_:1}),n(i,{type:"error",size:"large",style:{"margin-right":"5px",opacity:"0.5"}},{default:l(()=>[...e[55]||(e[55]=[r("缺少配置参数",-1)])]),_:1})]),y.value.length>0?(p(),f("div",ol,[s("p",il,"已缓存的站点 ("+c(y.value.length)+")",1),s("div",rl,[(p(!0),f(K,null,te(d.value.filter(a=>y.value.includes(a.name)),a=>Fe((p(),M(i,{key:a.name,type:Qe(a,_e(a.name)),class:se([{"is-selectable":_e(a.name),"cached-site-tag":!0},"site-tag"]),onClick:k=>_e(a.name)&&Je(He(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(c(a.name)+" ✓ ",1)]),_:2},1032,["type","class","onClick"])),[[Ae,Ne.value[a.name]]])),128))])])):C("",!0),d.value.some(a=>!y.value.includes(a.name))?(p(),f("div",dl,[e[56]||(e[56]=s("p",{class:"uncached-sites-label"},"未缓存的站点",-1)),s("div",ul,[(p(!0),f(K,null,te(d.value.filter(a=>!y.value.includes(a.name)),a=>Fe((p(),M(i,{key:a.name,type:Qe(a,_e(a.name)),class:se([{"is-selectable":_e(a.name)},"site-tag"]),style:cs(!a.has_cookie&&a.name!=="肉丝"||(a.name==="杜比"||a.name==="HDtime"||a.name==="肉丝")&&!a.has_passkey?"opacity: 0.5":""),size:"large",onClick:k=>_e(a.name)&&Je(He(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(c(a.name),1)]),_:2},1032,["type","class","style","onClick"])),[[Ae,Ne.value[a.name]]])),128))])])):C("",!0)]),s("div",cl,[n(m,{type:"warning",onClick:Xe,loading:b.value,plain:""},{default:l(()=>[...e[57]||(e[57]=[r(" IYUU查询 ",-1)])]),_:1},8,["loading"]),n(m,{type:"success",onClick:e[18]||(e[18]=a=>yt(L.value)),plain:""},{default:l(()=>[...e[58]||(e[58]=[r("上盒",-1)])]),_:1}),n(m,{onClick:e[19]||(e[19]=a=>u.value=!1)},{default:l(()=>[...e[59]||(e[59]=[r("取消",-1)])]),_:1})])]),_:1})])):C("",!0),n(ua,{onRefresh:wt}),E.value?(p(),f("div",{key:7,class:"filter-overlay",onClick:ee(Ve,["self"])},[n(A,{class:"filter-card",style:{"max-width":"720px"}},{header:l(()=>[s("div",pl,[e[61]||(e[61]=s("span",null,"IYUU 批量查询进度",-1)),n(m,{type:"danger",circle:"",onClick:Ve,plain:""},{default:l(()=>[...e[60]||(e[60]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",vl,[n(et,{column:2,border:"",size:"small"},{default:l(()=>[n(Z,{label:"任务ID"},{default:l(()=>[r(c(S.value?.task_id||"-"),1)]),_:1}),n(Z,{label:"状态"},{default:l(()=>[n(i,{type:S.value?.isRunning?"warning":S.value?.success?"success":"danger",size:"small"},{default:l(()=>[r(c(S.value?.isRunning?"进行中":S.value?.success?"已完成":"失败"),1)]),_:1},8,["type"])]),_:1}),n(Z,{label:"总数"},{default:l(()=>[r(c(S.value?.total??0),1)]),_:1}),n(Z,{label:"已处理"},{default:l(()=>[r(c(S.value?.processed??0),1)]),_:1}),n(Z,{label:"开始时间"},{default:l(()=>[r(c(S.value?.created_at||"-"),1)]),_:1}),n(Z,{label:"完成时间"},{default:l(()=>[r(c(S.value?.finished_at||"-"),1)]),_:1})]),_:1}),n(Se,{"content-position":"left"},{default:l(()=>[...e[62]||(e[62]=[r("结果",-1)])]),_:1}),s("div",fl,c(S.value?.message||"等待任务更新..."),1),S.value?.stats?(p(),M(et,{key:0,column:3,border:"",size:"small"},{default:l(()=>[n(Z,{label:"找到"},{default:l(()=>[r(c(S.value.stats.total_found??0),1)]),_:1}),n(Z,{label:"新增"},{default:l(()=>[r(c(S.value.stats.new_records??0),1)]),_:1}),n(Z,{label:"更新"},{default:l(()=>[r(c(S.value.stats.updated_records??0),1)]),_:1})]),_:1})):C("",!0)]),s("div",gl,[n(m,{type:"primary",onClick:Ee,plain:""},{default:l(()=>[...e[63]||(e[63]=[r("刷新",-1)])]),_:1}),n(m,{onClick:Ve},{default:l(()=>[...e[64]||(e[64]=[r("关闭",-1)])]),_:1})])]),_:1})])):C("",!0)])}}}),kl=nt(yl,[["__scopeId","data-v-eb209e9b"]]);export{kl as default};
