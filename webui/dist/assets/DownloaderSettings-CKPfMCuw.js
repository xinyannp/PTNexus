import{m as Z,r as _,o as ee,f as C,z as c,c as b,h as s,u as te,b as a,w as o,i as p,x as v,ag as N,e as r,ah as le,v as ae,F as S,k as A,g as y,l as ne,t as oe,M as se,af as ie,ai as q,Q as pe}from"./index-DnBcC30B.js";const re={class:"top-actions glass-pagination"},ue={class:"realtime-switch-container"},ce={class:"settings-view"},de={class:"downloader-grid"},me={class:"card-header"},_e={class:"header-controls"},fe={class:"name-and-client-row"},ve={class:"proxy-settings-row"},ge={class:"path-mapping-container"},ye={class:"mapping-list"},k="/api",Ve={__name:"DownloaderSettings",setup(he){const u=_({downloaders:[],realtime_speed_enabled:!0}),$=_(!0),V=_(!1),D=_(null),d=_({}),h=_(!1),I=_(null),x=_([]);ee(()=>{M()});const M=async()=>{$.value=!0;try{const l=await C.get(`${k}/settings`);l.data&&(l.data.downloaders||(l.data.downloaders=[]),typeof l.data.realtime_speed_enabled!="boolean"&&(l.data.realtime_speed_enabled=!0),l.data.downloaders.forEach(e=>{e.id||(e.id=`client_${Date.now()}_${Math.random()}`),typeof e.use_proxy!="boolean"&&(e.use_proxy=!1),e.proxy_port||(e.proxy_port=9090),(!e.path_mappings||!Array.isArray(e.path_mappings))&&(e.path_mappings=[])}),u.value=l.data)}catch(l){c.error("加载设置失败！"),console.error(l)}finally{$.value=!1}},z=async()=>{V.value=!0;try{await C.post(`${k}/settings`,u.value),c.success("设置已成功保存并应用！"),M()}catch(l){c.error("保存设置失败！"),console.error(l)}finally{V.value=!1}},E=()=>{u.value.downloaders.push({id:`new_${Date.now()}`,enabled:!0,name:"新下载器",type:"qbittorrent",host:"",username:"",password:"",use_proxy:!1,proxy_port:9090,path_mappings:[]})},w=l=>{pe.confirm("您确定要删除这个下载器配置吗？此操作不可撤销。","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{L(l),c({type:"success",message:"下载器已删除（尚未保存）。"})}).catch(()=>{})},L=l=>{u.value.downloaders=u.value.downloaders.filter(e=>e.id!==l)},m=l=>{d.value[l]&&delete d.value[l]},R=async l=>{m(l.id),D.value=l.id;try{const i=(await C.post(`${k}/test_connection`,l)).data;i.success?(c.success(i.message),d.value[l.id]="success"):(c.error(i.message),d.value[l.id]="error")}catch(e){c.error("测试连接请求失败，请检查网络或后端服务。"),console.error("Test connection error:",e),d.value[l.id]="error"}finally{D.value=null}},F=l=>{I.value=l,(!l.path_mappings||!Array.isArray(l.path_mappings))&&(l.path_mappings=[]),x.value=JSON.parse(JSON.stringify(l.path_mappings)),h.value=!0},J=()=>{x.value.push({remote:"",local:""})},O=l=>{x.value.splice(l,1)},G=async()=>{const l=x.value.filter(e=>e.remote.trim()!==""&&e.local.trim()!=="");I.value.path_mappings=l,V.value=!0;try{await C.post(`${k}/settings`,u.value),h.value=!1,c.success("路径映射已保存！"),M()}catch(e){c.error("保存路径映射失败！"),console.error(e)}finally{V.value=!1}};return(l,e)=>{const i=r("el-button"),Q=r("el-icon"),B=r("el-switch"),g=r("el-form-item"),T=r("el-tooltip"),f=r("el-input"),P=r("el-option"),j=r("el-select"),H=r("el-form"),K=r("el-card"),W=r("el-alert"),X=r("el-dialog"),Y=ae("loading");return y(),b(S,null,[s("div",re,[a(i,{type:"primary",size:"large",onClick:E,icon:v(N)},{default:o(()=>[...e[3]||(e[3]=[p(" 添加下载器 ",-1)])]),_:1},8,["icon"]),a(i,{type:"success",size:"large",onClick:z,loading:V.value},{default:o(()=>[a(Q,null,{default:o(()=>[a(v(le))]),_:1}),e[4]||(e[4]=p(" 保存所有设置 ",-1))]),_:1},8,["loading"]),s("div",ue,[a(T,{content:"开启后，图表页将每秒获取一次数据以显示“近1分钟”实时速率。关闭后将每分钟获取一次，以降低系统负载。",placement:"bottom","hide-after":0},{default:o(()=>[a(g,{label:"开启实时速率",class:"switch-form-item"},{default:o(()=>[a(B,{modelValue:u.value.realtime_speed_enabled,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.realtime_speed_enabled=t),size:"large","inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})]),_:1})])]),te((y(),b("div",ce,[s("div",de,[(y(!0),b(S,null,A(u.value.downloaders,t=>(y(),ne(K,{key:t.id,class:"downloader-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},{header:o(()=>[s("div",me,[s("span",null,oe(t.name||"新下载器"),1),s("div",_e,[a(i,{type:d.value[t.id]==="success"?"success":d.value[t.id]==="error"?"danger":"info",plain:!d.value[t.id],style:{width:"90px"},onClick:n=>R(t),loading:D.value===t.id,icon:v(se)},{default:o(()=>[...e[5]||(e[5]=[p(" 测试连接 ",-1)])]),_:1},8,["type","plain","onClick","loading","icon"]),a(i,{type:"warning",icon:v(ie),style:{width:"90px"},onClick:n=>F(t)},{default:o(()=>[...e[6]||(e[6]=[p(" 路径映射 ",-1)])]),_:1},8,["icon","onClick"]),a(B,{modelValue:t.enabled,"onUpdate:modelValue":n=>t.enabled=n,style:{margin:"0 10px"}},null,8,["modelValue","onUpdate:modelValue"]),a(i,{type:"danger",icon:v(q),circle:"",onClick:n=>w(t.id)},null,8,["icon","onClick"])])])]),default:o(()=>[a(H,{model:t,"label-position":"left","label-width":"auto"},{default:o(()=>[a(g,{label:"名称"},{default:o(()=>[s("div",fe,[a(f,{modelValue:t.name,"onUpdate:modelValue":n=>t.name=n,placeholder:"例如：家庭服务器 qB",class:"name-input",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onInput"]),a(j,{modelValue:t.type,"onUpdate:modelValue":n=>t.type=n,placeholder:"请选择类型",class:"client-type-select",onChange:n=>m(t.id)},{default:o(()=>[a(P,{label:"qBittorrent",value:"qbittorrent"}),a(P,{label:"Transmission",value:"transmission"})]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(g,{label:"代理设置"},{default:o(()=>[s("div",ve,[a(f,{modelValue:t.proxy_port,"onUpdate:modelValue":n=>t.proxy_port=n,type:"number",placeholder:"9090",class:"proxy-port-input",min:1,max:65535,onInput:n=>m(t.id)},{prepend:o(()=>[...e[7]||(e[7]=[p("端口",-1)])]),_:1},8,["modelValue","onUpdate:modelValue","onInput"]),a(T,{content:t.type==="transmission"?"通过代理获取截图、MediaInfo等媒体信息。注意：TR代理不包括统计数据获取。":"通过Go语言编写的专用代理连接，可解决网络延迟、获取数据不准等问题。",placement:"top","hide-after":0},{default:o(()=>[a(B,{modelValue:t.use_proxy,"onUpdate:modelValue":n=>t.use_proxy=n,size:"large","inline-prompt":"","active-text":"远程","inactive-text":"本地",onChange:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["content"])])]),_:2},1024),a(g,{label:"主机地址"},{default:o(()=>[a(f,{modelValue:t.host,"onUpdate:modelValue":n=>t.host=n,placeholder:t.type==="transmission"?"例如：192.168.1.10:9091 或 http://192.168.1.10:9091":"例如：192.168.1.10:8080",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"])]),_:2},1024),a(g,{label:"用户名"},{default:o(()=>[a(f,{modelValue:t.username,"onUpdate:modelValue":n=>t.username=n,placeholder:"登录用户名",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),a(g,{label:"密码"},{default:o(()=>[a(f,{modelValue:t.password,"onUpdate:modelValue":n=>t.password=n,type:"password","show-password":"",placeholder:"登录密码（未修改则留空）",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024)]),_:2},1032,["model"])]),_:2},1024))),128))])])),[[Y,$.value]]),a(X,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),title:`路径映射配置 - ${I.value?.name||""}`,width:"700px","close-on-click-modal":!1},{footer:o(()=>[a(i,{onClick:e[1]||(e[1]=t=>h.value=!1)},{default:o(()=>[...e[12]||(e[12]=[p("取消",-1)])]),_:1}),a(i,{type:"primary",onClick:G},{default:o(()=>[...e[13]||(e[13]=[p("确定",-1)])]),_:1})]),default:o(()=>[s("div",ge,[a(W,{title:"路径映射说明",type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:o(()=>[...e[8]||(e[8]=[s("p",null,"配置下载器路径到 PT Nexus 容器内路径的映射关系。",-1),s("p",null,[s("strong",null,"下载器路径："),p("下载器中显示的种子保存路径")],-1),s("p",null,[s("strong",null,"视频文件路径："),p("挂载到 PT Nexus 容器内的路径或者盒子本地路径的路径")],-1)])]),_:1}),s("div",ye,[(y(!0),b(S,null,A(x.value,(t,n)=>(y(),b("div",{key:n,class:"mapping-item"},[a(f,{modelValue:t.remote,"onUpdate:modelValue":U=>t.remote=U,placeholder:"例如：/downloads",class:"mapping-input"},{prepend:o(()=>[...e[9]||(e[9]=[p("下载器路径",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"]),a(f,{modelValue:t.local,"onUpdate:modelValue":U=>t.local=U,placeholder:"例如：/app/data/qb1",class:"mapping-input"},{prepend:o(()=>[...e[10]||(e[10]=[p("视频文件路径",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"]),a(i,{type:"danger",icon:v(q),circle:"",onClick:U=>O(n)},null,8,["icon","onClick"])]))),128))]),a(i,{type:"primary",icon:v(N),style:{width:"100%","margin-top":"16px"},onClick:J},{default:o(()=>[...e[11]||(e[11]=[p(" 添加映射规则 ",-1)])]),_:1},8,["icon"])])]),_:1},8,["modelValue","title"])],64)}}},be=Z(Ve,[["__scopeId","data-v-8692b92e"]]);export{be as default};
